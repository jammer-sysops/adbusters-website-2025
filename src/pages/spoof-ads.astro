---
import { getCollection } from 'astro:content';
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.tsx';
import { Image } from 'astro:assets';

// Get all spoof ads, sorted by creation date (newest first)
const spoofAds = await getCollection('spoof-ads');
const sortedSpoofAds = spoofAds.sort((a, b) => {
  const dateA = a.data.createdOn || new Date(0);
  const dateB = b.data.createdOn || new Date(0);
  return dateB.getTime() - dateA.getTime();
});

// Get unique categories
const categories = [...new Set(spoofAds.map(ad => ad.data.spoofCategory).filter(Boolean))].sort();
---

<Layout title="Spoof Ads - adbusters">
  <main class="container mx-auto px-4 py-8">
      <Header 
    title="Spoof Ads"
    subtitle="Culture jamming through subvertising"
    navigationText="Browse Articles"
    navigationHref="/articles"
    client:load
  />
    <div class="max-w-7xl mx-auto">
      <!-- Category Filter -->
      <div class="mb-8">
        <div class="flex flex-wrap gap-2">
          <button class="filter-btn active px-4 py-2 bg-red-600 text-white font-medium hover:bg-red-700 transition-colors rounded text-sm" data-category="all">
            All
          </button>
          {categories.map(category => (
            <button class="filter-btn px-4 py-2 bg-gray-200 text-gray-800 font-medium hover:bg-gray-300 transition-colors rounded text-sm" data-category={category}>
              {category}
            </button>
          ))}
        </div>
      </div>
      
      <!-- Spoof Ads Grid -->
      <div id="spoof-ads-container">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          {sortedSpoofAds.map((spoofAd) => (
            <article class="group cursor-pointer" data-spoof-category={spoofAd.data.spoofCategory || ''}>
              <a href={`/spoof-ads/${spoofAd.slug}`} class="block">
                <div class="relative overflow-hidden bg-gray-100">
                  <Image 
                    src={spoofAd.data.spoofImage} 
                    alt={spoofAd.data.name}
                    class="w-full h-auto object-contain transition-transform duration-300 group-hover:scale-105"
                    loading="lazy"
                    width={400}
                    height={500}
                    format="webp"
                    quality={85}
                  />
                  
                  <!-- Black overlay - hidden by default, visible on group hover -->
                  <div class="absolute inset-0 bg-black opacity-0 group-hover:opacity-70 transition-opacity duration-300 z-10"></div>
                  
                  <!-- Category badge - only visible on hover -->
                  {spoofAd.data.spoofCategory && (
                    <div class="absolute top-2 left-2 bg-red-600 text-white px-2 py-1 text-xs font-bold uppercase tracking-wider opacity-0 group-hover:opacity-100 transition-opacity duration-300 z-20">
                      {spoofAd.data.spoofCategory}
                    </div>
                  )}
                  
                  <!-- Text overlay on hover -->
                  <div class="absolute inset-0 flex items-end z-20">
                    <div class="p-4 text-white opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                      <h3 class="font-bold text-lg mb-2">
                        {spoofAd.data.name}
                      </h3>
                      {spoofAd.data.caption && (
                        <p class="text-sm opacity-90 line-clamp-3">
                          {spoofAd.data.caption}
                        </p>
                      )}
                    </div>
                  </div>
                </div>
              </a>
            </article>
          ))}
        </div>
        
        {sortedSpoofAds.length === 0 && (
          <div class="text-center py-12">
            <p class="text-gray-500 text-lg">No spoof ads found.</p>
          </div>
        )}
      </div>
    </div>
  </main>
  
  <script>
    // Category filtering functionality
    document.addEventListener('DOMContentLoaded', function() {
      const filterBtns = document.querySelectorAll<HTMLButtonElement>('.filter-btn');
      
      filterBtns.forEach(btn => {
        btn.addEventListener('click', function(this: HTMLButtonElement) {
          const category = this.getAttribute('data-category');
          
          // Update active button
          filterBtns.forEach(b => {
            b.classList.remove('active', 'bg-red-600', 'text-white');
            b.classList.add('bg-gray-200', 'text-gray-800');
          });
          this.classList.add('active', 'bg-red-600', 'text-white');
          this.classList.remove('bg-gray-200', 'text-gray-800');
          
          // Filter spoof ads
          const spoofAdCards = document.querySelectorAll<HTMLElement>('[data-spoof-category]');
          spoofAdCards.forEach(card => {
            if (category === 'all' || card.getAttribute('data-spoof-category') === category) {
              (card as HTMLElement).style.display = 'block';
            } else {
              (card as HTMLElement).style.display = 'none';
            }
          });
        });
      });
    });
  </script>
</Layout>