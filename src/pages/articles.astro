---
import Layout from '../layouts/Layout.astro';
import { getCollection } from 'astro:content';
import ArticleGrid from '../components/ArticleGrid';
import Header from '../components/Header';

// Fetch all articles from content collection
const articles = await getCollection('articles');

// Sort articles by published date (newest first)
// Convert dates to strings for React component serialization
const sortedArticles = articles.sort((a, b) => {
  const dateA = new Date(a.data.publishedOn || 0);
  const dateB = new Date(b.data.publishedOn || 0);
  return dateB.getTime() - dateA.getTime();
}).map(article => ({
  ...article,
  data: {
    ...article.data,
    publishedOn: article.data.publishedOn ? article.data.publishedOn.toISOString() : undefined
  }
}));
---

<Layout>
  <main class="min-h-screen bg-white">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
      <Header 
        title="Articles" 
        subtitle="Journal of the mental environment" 
        navigationText="Browse Spoof Ads" 
        navigationHref="/spoof-ads" 
        client:load 
      />
      
      <ArticleGrid articles={sortedArticles} showExcerpts={true} client:load />
      
      {articles.length === 0 && (
        <div class="text-center py-12">
          <p class="text-gray-500">No articles found.</p>
        </div>
      )}
    </div>
  </main>
</Layout>

