---
import Layout from '../layouts/Layout.astro';
import { getCollection } from 'astro:content';
import Header from '../components/Header';
import Section from '../components/Section';
import { Image } from 'astro:assets';

// Fetch latest 6 articles for homepage
const articles = await getCollection('articles');

// Sort articles by published date (newest first) and take first 6
const sortedArticles = articles.sort((a, b) => {
  const dateA = new Date(a.data.publishedOn || 0);
  const dateB = new Date(b.data.publishedOn || 0);
  return dateB.getTime() - dateA.getTime();
}).slice(0, 6);

// Helper function to get excerpt
const getExcerpt = (content: string, maxLength: number = 200) => {
  const plainText = content.replace(/[#*`]/g, '').replace(/\n+/g, ' ').trim();
  if (plainText.length <= maxLength) return plainText;
  return plainText.substring(0, maxLength).trim() + '...';
};

// Helper function to format date
const formatDate = (date: Date) => {
  return date.toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'short',
    day: 'numeric'
  });
};
---

<Layout>
	<main class="min-h-screen bg-white">
		<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
			<Header 
				navigationText="Browse Spoof Ads" 
				navigationHref="/spoof-ads" 
				client:load 
			/>
			
			<Section title="Latest Articles" viewAllLink="/articles" viewAllText="View all articles â†’" client:load>
				<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
					{sortedArticles.map((article) => (
						<article class="group cursor-pointer">
							<a href={`/articles/${article.slug}`} class="block">
								<div class="space-y-4">
									{article.data.featuredImage && (
										<div class="aspect-video overflow-hidden rounded-lg bg-gray-100">
											<Image 
												src={article.data.featuredImage} 
												alt={article.data.title}
												class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"
												width={400}
												height={225}
												format="webp"
												quality={85}
												loading="lazy"
											/>
										</div>
									)}
									
									<div class="space-y-2">
										<h3 class="text-lg font-semibold text-gray-900 group-hover:text-gray-600 transition-colors line-clamp-2">
											{article.data.title}
										</h3>
										
										{article.data.publishedOn && (
											<time datetime={article.data.publishedOn.toISOString()} class="text-sm text-gray-500">
												{formatDate(article.data.publishedOn)}
											</time>
										)}

										<p class="text-gray-600 line-clamp-3">
											{getExcerpt(article.body)}
										</p>
									</div>
								</div>
							</a>
						</article>
					))}
				</div>
			</Section>
		</div>
	</main>
</Layout>

